var data = [];
var idArray = [];
var searchParams = [];

Goal = function(id){
  this.id = id;
  this. students = [];
};

Student = function(id){
  this.id = id
  this.steps = [];
};

Step = function(stepnum, status){
  this.stepNumber = stepnum;
  this.status = status
}

  $scope.getGoalsIDs = (function(){
    monitoringService.getGoalsIDs($scope.user).then(function(response){
    var gResponse = response.data

    for(var i = 0; i < gResponse.length; i++){
      idArray.push(gResponse[i].id)
      data.push(new Goal(gResponse[i].id))
    }


    for(var x = 0; x < idArray.length; x++){

      var id = idArray[x]

      $scope.getGoalStudents = function(id){

        monitoringService.getGoalStudents(id).then(function(responseB){

           for(var j = 0; j < responseB.length; j++){
              var studentID = responseB[j].studentid
             for(var y = 0; y < data.length; y++){
               if(data[y].id === id){
                 data[y].students.push(new Student(studentID))

               }
             }
           searchParams.push({goal:id, student:studentID})

          }
        return searchParams
        })
      }

      $scope.getGoalStudents(id)
    }

console.log(data);
$timeout(function(){
  for(var z = 0; z < searchParams.length; z++){
    var gID = searchParams[z].goal
    var sID = searchParams[z].student

    $scope.getSteps = (function (gID, sID){
      var goal =searchParams[z].goal
      var student =searchParams[z].student

      monitoringService.getSteps(goal, student).then(function(responseC){

        for (var r = 0; r < responseC.length; r++){
          var stepnum = responseC[r].stepnumber
          var status = responseC[r].status
         }

         for(var d = 0; d < data.length; d++){
           //console.log(data[d].students);
           for(var s = 0; s < data[d].students.length; s++){
            // console.log(data[d].id);
            // console.log(data[d].students[s]);
                //  if(data[d].id !== goal){
                //    console.log('diff goal');
                //    //data.push(new Goal(goal))
                //    console.log(data);
                //  }
                 if(data[d].id === goal && data[d].students[s].id){
                  // data[d].students[s].steps.push(new Step(stepnum, status))
                   console.log('same goal and student');
                   console.log(data);
                 }
                 else{
                  console.log('same goal', data[d].students[s].id);
                  console.log(data[d].students);
                   //data[d].students.push(new Student(student))
                 }
                //  else{
                //    console.log('diff goal');
                //    //
                //  }
           }
         }


      })
    })();

  }
}, 100)


  })

})();


//console.log(searchParams);


});




//  SERVICE//
this.getGoalsIDs = function(user){
  var id = user.id
  var defer = $q.defer();
    $http({
      method:"GET",
      url:'/goals/'+ id
   }).then(function(response){

     defer.resolve(response);
   })
   return defer.promise;
 }

 this.getGoalStudents = function(id){
   var defer = $q.defer();
   $http({
     method:"GET",
     url:'/goalStudents/'+ id
  }).then(function(response){
  //  console.log(response);
    defer.resolve(response.data);
  })
  return defer.promise;
 }

 this.getSteps = function(gID, sID){
   var defer = $q.defer();
   $http({
     method:"GET",
     url:'/studentsSteps/'+ gID + '/'+ sID
  }).then(function(response){
    defer.resolve(response.data);
  })
  return defer.promise;
 }
